<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>정보 입력 | MZ사주</title>

    <meta name="description" content="사주와 MBTI 분석을 위한 정보 입력">

    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
</head>
<body class="input-page">
    <div class="bg-effects">
        <div class="bg-gradient"></div>
        <div class="bg-grid"></div>
    </div>

    <div class="container">
        <header class="header">
            <a href="/" class="logo">
                <span class="logo-text">MZ사주</span>
            </a>
        </header>

        <section class="input-section">
            <form action="/analyze" method="POST" class="input-form" id="analysisForm">

                <div class="form-group">
                    <label class="form-label">생년월일</label>
                    <input type="date" name="birthdate" id="birthdate" required class="date-input">
                </div>

                <div class="form-group">
                    <label class="form-label">달력</label>
                    <div class="toggle-buttons">
                        <label class="toggle-btn active">
                            <input type="radio" name="is_lunar" value="false" checked>
                            <span>양력</span>
                        </label>
                        <label class="toggle-btn">
                            <input type="radio" name="is_lunar" value="true">
                            <span>음력</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">성별</label>
                    <div class="toggle-buttons">
                        <label class="toggle-btn">
                            <input type="radio" name="gender" value="male" required>
                            <span>남성</span>
                        </label>
                        <label class="toggle-btn">
                            <input type="radio" name="gender" value="female">
                            <span>여성</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">MBTI</label>
                    <div class="mbti-selector">
                        <div class="mbti-tabs">
                            <label class="mbti-tab">
                                <input type="radio" name="mbti_ei" value="I" required>
                                <span>I 내향</span>
                            </label>
                            <label class="mbti-tab">
                                <input type="radio" name="mbti_ei" value="E">
                                <span>E 외향</span>
                            </label>
                        </div>
                        <div class="mbti-options" id="mbtiOptions">
                            <!-- JS로 동적 생성 -->
                        </div>
                    </div>
                    <p class="form-hint">MBTI 모르면 <a href="https://www.16personalities.com/ko" target="_blank">검사하기</a></p>
                </div>

                <div class="form-group">
                    <label class="form-label">보고 싶은 운세</label>
                    <div class="fortune-cards">
                        <label class="fortune-card">
                            <input type="radio" name="fortune_type" value="overall" required>
                            <span class="fortune-title">종합운</span>
                            <span class="fortune-desc">나의 전체적인 사주 분석</span>
                        </label>
                        <label class="fortune-card">
                            <input type="radio" name="fortune_type" value="love">
                            <span class="fortune-title">연애운</span>
                            <span class="fortune-desc">인연과 연애 성향</span>
                        </label>
                        <label class="fortune-card">
                            <input type="radio" name="fortune_type" value="money">
                            <span class="fortune-title">금전운</span>
                            <span class="fortune-desc">재물과 금전 흐름</span>
                        </label>
                        <label class="fortune-card">
                            <input type="radio" name="fortune_type" value="career">
                            <span class="fortune-title">직업운</span>
                            <span class="fortune-desc">적성과 진로 방향</span>
                        </label>
                    </div>
                </div>

                <input type="hidden" name="mbti" id="mbtiValue">

                <div class="submit-section">
                    <button type="submit" class="submit-button">
                        분석하기
                    </button>
                </div>
            </form>
        </section>

        <footer class="footer">
            <p class="copyright">© 2025 MZ사주</p>
        </footer>
    </div>

    <script>
        // MBTI 데이터
        const mbtiTypes = {
            'I': ['INTJ', 'INTP', 'INFJ', 'INFP', 'ISTJ', 'ISFJ', 'ISTP', 'ISFP'],
            'E': ['ENTJ', 'ENTP', 'ENFJ', 'ENFP', 'ESTJ', 'ESFJ', 'ESTP', 'ESFP']
        };

        const mbtiNames = {
            'INTJ': '전략가', 'INTP': '논리술사', 'INFJ': '옹호자', 'INFP': '중재자',
            'ISTJ': '현실주의자', 'ISFJ': '수호자', 'ISTP': '장인', 'ISFP': '모험가',
            'ENTJ': '통솔자', 'ENTP': '변론가', 'ENFJ': '선도자', 'ENFP': '활동가',
            'ESTJ': '경영자', 'ESFJ': '집정관', 'ESTP': '사업가', 'ESFP': '연예인'
        };

        // I/E 탭 전환
        const eiRadios = document.querySelectorAll('input[name="mbti_ei"]');
        const mbtiOptions = document.getElementById('mbtiOptions');
        const mbtiValue = document.getElementById('mbtiValue');

        eiRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                const types = mbtiTypes[this.value];
                mbtiOptions.innerHTML = types.map(type => `
                    <label class="mbti-option">
                        <input type="radio" name="mbti_type" value="${type}">
                        <span>${type}</span>
                        <small>${mbtiNames[type]}</small>
                    </label>
                `).join('');

                // 선택 시 hidden input 업데이트
                mbtiOptions.querySelectorAll('input').forEach(input => {
                    input.addEventListener('change', () => {
                        mbtiValue.value = input.value;
                    });
                });
            });
        });

        // 토글 버튼 활성화
        document.querySelectorAll('.toggle-buttons').forEach(group => {
            group.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    group.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });
        });

        // 운세 카드 선택
        document.querySelectorAll('.fortune-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.fortune-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
            });
        });

        // 폼 제출
        const form = document.getElementById('analysisForm');
        form.addEventListener('submit', function(e) {
            // 생년월일 파싱
            const birthdate = document.getElementById('birthdate').value;
            if (birthdate) {
                const [year, month, day] = birthdate.split('-');

                // hidden fields 추가
                const addHidden = (name, value) => {
                    let input = form.querySelector(`input[name="${name}"][type="hidden"]`);
                    if (!input) {
                        input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = name;
                        form.appendChild(input);
                    }
                    input.value = value;
                };

                addHidden('birth_year', year);
                addHidden('birth_month', month);
                addHidden('birth_day', day);
            }

            // MBTI 체크
            if (!mbtiValue.value) {
                e.preventDefault();
                alert('MBTI를 선택해주세요');
                return;
            }

            const button = this.querySelector('.submit-button');
            button.innerHTML = '분석 중...';
            button.disabled = true;
        });
    </script>
</body>
</html>
